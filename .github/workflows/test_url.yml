name: ğŸ§ª Debug Private Download (GH CLI)

on:
  workflow_dispatch:
    inputs:
      repo:
        description: "Repositorio privado (formato: owner/repo)"
        required: true
        default: "SolucionesHR/mercados_cuba_delivery"
      tag:
        description: "Tag o versiÃ³n del release"
        required: true
        default: "v1.0.5"
      pattern:
        description: "PatrÃ³n del nombre del archivo a descargar (puede ser *.apk)"
        required: true
        default: "mensajero.apk"

jobs:
  debug-gh-download:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ Iniciar flujo
        run: echo "ğŸ” Iniciando descarga privada con gh release download..."

      - name: ğŸ”‘ Configurar GH CLI
        env:
          GH_TOKEN: ${{ secrets.PUBLIC_REPO_TOKEN }}
        run: |
          echo "âœ… Autenticando GH CLI con token..."
          echo "$GH_TOKEN" | gh auth login --with-token
          echo "ğŸ‘¤ Usuario autenticado:"
          gh auth status

      - name: ğŸ“¦ Descargar asset desde release privado
        env:
          GH_TOKEN: ${{ secrets.PUBLIC_REPO_TOKEN }}
        run: |
          echo "ğŸ“¥ Descargando desde ${{ github.event.inputs.repo }} - tag ${{ github.event.inputs.tag }}"
          gh release download \
            ${{ github.event.inputs.tag }} \
            --repo "${{ github.event.inputs.repo }}" \
            --pattern "${{ github.event.inputs.pattern }}" \
            --verbose

      - name: ğŸ§¾ Verificar archivo descargado
        run: |
          echo "ğŸ“‚ Archivos descargados:"
          ls -lh
          echo "ğŸ” InformaciÃ³n detallada:"
          file "${{ github.event.inputs.pattern }}"
