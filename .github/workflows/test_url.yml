name: ðŸ§ª Debug Private Download (GH CLI)

on:
  workflow_dispatch:
    inputs:
      repo:
        description: "Repositorio privado (formato: owner/repo)"
        required: true
        default: "SolucionesHR/mercados_cuba_delivery"
      tag:
        description: "Tag o versiÃ³n del release"
        required: true
        default: "v1.0.5"
      pattern:
        description: "PatrÃ³n del nombre del archivo a descargar (por ejemplo *.apk)"
        required: true
        default: "mensajero.apk"

jobs:
  debug-gh-download:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ Iniciar flujo
        run: echo "ðŸ” Iniciando descarga privada con gh release download..."

      - name: ðŸ”‘ Verificar autenticaciÃ³n actual
        env:
          GH_TOKEN: ${{ secrets.PUBLIC_REPO_TOKEN }}
        run: |
          echo "ðŸ” Verificando autenticaciÃ³n de GH CLI..."
          gh auth status || echo "âš ï¸ GH CLI aÃºn no autenticado, pero GH_TOKEN estÃ¡ disponible."

      - name: ðŸ“¦ Descargar asset desde release privado
        env:
          GH_TOKEN: ${{ secrets.PUBLIC_REPO_TOKEN }}
        run: |
          echo "ðŸ“¥ Descargando desde ${{ github.event.inputs.repo }} - tag ${{ github.event.inputs.tag }}"
          gh release download \
            ${{ github.event.inputs.tag }} \
            --repo "${{ github.event.inputs.repo }}" \
            --pattern "${{ github.event.inputs.pattern }}" \
            --clobber

      - name: ðŸ§¾ Verificar archivo descargado
        run: |
          echo "ðŸ“‚ Archivos descargados:"
          ls -lh
          echo "ðŸ” InformaciÃ³n detallada del archivo:"
          file "${{ github.event.inputs.pattern }}" || echo "âš ï¸ No se encontrÃ³ el archivo esperado."
          echo "âœ… Si el tamaÃ±o del archivo es >0, la descarga fue exitosa."
