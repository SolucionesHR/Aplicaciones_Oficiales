name: ðŸ“¦ Agregar nueva app o versiÃ³n desde URL

on:
  workflow_dispatch:
    inputs:
      app_name:
        description: "Nombre de la aplicaciÃ³n (ej: CryptoPredict)"
        required: true
      version:
        description: "VersiÃ³n (ej: 1.0.0)"
        required: true
      description:
        description: "DescripciÃ³n breve (ej: App de predicciÃ³n de criptomonedas)"
        required: true
      file_url:
        description: "URL del archivo APK o instalador (.apk, .exe, .zip, etc)"
        required: true

jobs:
  add_app:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ§¾ Clonar el repositorio
        uses: actions/checkout@v4

      - name: ðŸ“¥ Descargar archivo desde la URL
        run: |
          mkdir -p "apps/${{ github.event.inputs.app_name }}"
          cd "apps/${{ github.event.inputs.app_name }}"
          echo "Descargando archivo..."
          wget -q "${{ github.event.inputs.file_url }}" -O "${{ github.event.inputs.app_name }}_${{ github.event.inputs.version }}.apk"
          echo "âœ… Archivo descargado: ${PWD}/${{ github.event.inputs.app_name }}_${{ github.event.inputs.version }}.apk"

      - name: âœï¸ Actualizar README.md
        run: |
          APP_NAME="${{ github.event.inputs.app_name }}"
          VERSION="${{ github.event.inputs.version }}"
          DESC="${{ github.event.inputs.description }}"
          LINK="https://github.com/${{ github.repository }}/tree/main/apps/${APP_NAME}"

          # Si no existe el archivo README, lo creamos
          if [ ! -f README.md ]; then
            echo "# ðŸš€ Aplicaciones Oficiales de Soluciones HR" > README.md
            echo "" >> README.md
            echo "| AplicaciÃ³n | DescripciÃ³n | VersiÃ³n | Descarga |" >> README.md
            echo "|-------------|--------------|----------|-----------|" >> README.md
          fi

          # Verifica si ya existe la app en la tabla
          if grep -q "${APP_NAME}" README.md; then
            echo "ðŸ”„ Actualizando versiÃ³n existente..."
            sed -i "s|\(${APP_NAME}.*|\1|" README.md
            sed -i "s|\(${APP_NAME}.*|\1|" README.md
          else
            echo "ðŸ†• Agregando nueva app al README..."
            echo "| **${APP_NAME}** | ${DESC} | ${VERSION} | [ðŸ“¥ Descargar](${LINK}) |" >> README.md
          fi

      - name: ðŸ’¾ Confirmar y subir cambios
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add .
          git commit -m "ðŸ“¦ Agregada/Actualizada app: ${{ github.event.inputs.app_name }} v${{ github.event.inputs.version }}"
          git push
